{% extends "base.html" %}

{% block head %}
    <title>详情页_皮爷の博客</title>

{% endblock %}

{% block content %}
	<article>
		<h1 class="t_nav">
			<p class="n1">文章</p>
		</h1>
		<div class="infosbox">
			<div class="newsview">
				<h3 class="news_title">{{ article.title }}</h3>
				<div class="bloginfo">
					<ul>
						<li class="author"><a href="#">{{ article.author.username }}</a></li>
						<li class="timer">{{ article.public_time }}</li>
						<li class="view">{{ article.click_num }}人已阅读</li>
						<li class="like">{{ total_count }}人觉得很赞</li>
					</ul>
				</div>
{#				<div class="tags"><a href="#" target="_blank">个人博客</a><a href="#" target="_blank">小世界</a></div>#}
				<div class="news_about"><strong>简介</strong>{{ article.description  }}</div>
				<div class="news_con">
					<img alt="文章图片" src="{{ article.picture }}"  style="height: 200px; width: 600px; margin-left: 50px"><br>
                    <br>
                    <p style="text-indent: 2em">{{ article.content | safe }}</p>
                </div>
			</div>
			<div class="share">
				<p class="diggit">
					<a href="#">
                        {% if praise_count == 0 %}
                            <a href="/praise_article?article_id={{ article.id }}&&count=0" title="点赞，支持一下">很赞哦！</a>
                        {% else %}
                            <a href="/praise_article?article_id={{ article.id }}&&count=1" title="取消点赞">已点赞！</a>
                        {% endif %}
					</a>(<b id="diggnum">{{ total_count }}</b>)
				</p>
				<p class="dasbox"><a href="#" class="dashang" title="打赏，支持一下">打赏本站</a></p>
				<div class="hide_box"></div>
			</div>
			<div class="nextinfo">
				<p>上一篇：
                    {% if last_article == "" %}
                        无上一篇
                    {% else %}
                        <a href="/article?article_id={{ last_article.id }}">{{ last_article.title }}</a>
                    {% endif %}
                </p>
				<p>下一篇：
                    {% if next_article == "" %}
                        无下一篇
                    {% else %}
                        <a href="/article?article_id={{ next_article.id }}">{{ next_article.title }}</a>
                    {% endif %}
                </p>
			</div>
			<div class="news_pl">
				<h2>文章评论</h2>
				<ul>
					<div class="gbko">
						<div class="l_box f_l" style="padding:20px;">
							<div class="commentstitle">
								<h3 id="comments">到现在<span class="commentsnumber">有<span id="comment_number">{{ comment_count }}</span>条评论</span></h3>
							<div id="commentform">
                                <div class="comment-box">
                                    {% if username != "" %}
                                        <div class="new-comment-box1 comment">
                                            <input class="form-control" style="width: 400px; height: 18px" placeholder="说下此刻的想法..."></input>
                                            <button type="button" style="" class="btn btn-sucess pull-right">评论</button>
                                        </div>
                                        <div class="new-comment-box comment" style="display:none">
                                            <input class="form-control" style="width: 400px; height: 18px" placeholder="说一句..."></input>
                                            <button type="button" style="" class="btn btn-sucess pull-right">发表</button>
                                        </div>
                                    {% else %}
                                        <div class="jumbotron">
{#                                            <h4 style="text-align: center"><a class="btn-link" href="/?next={{ request.path }}">登陆</a>后评论</h4>#}
                                            <h4 style="text-align: center"><a class="btn-link" href="/login">登陆</a>后评论</h4>
                                        </div>
                                    {% endif %}
                                </div>
							</div>
							</div>
							<div class="comment-list">
                            </div>

						</div>
					</div>
				</ul>
			</div>
		</div>
		<div class="sidebar">
			<div class="zhuanti">
				<h2 class="hometitle">特别推荐</h2>
				<ul>
					<li> <i><img src="../static/images/banner03.jpg"></i>
						<p>帝国cms调用方法 <span><a href="#">阅读</a></span> </p>
					</li>
					<li> <i><img src="../static/images/b04.jpg"></i>
						<p>5.20 我想对你说 <span><a href="#">阅读</a></span></p>
					</li>
					<li> <i><img src="../static/images/b05.jpg"></i>
						<p>个人博客，属于我的小世界！ <span><a href="#">阅读</a></span></p>
					</li>
				</ul>
			</div>
			<div class="tuijian">
				<h2 class="hometitle">推荐文章</h2>
				<ul class="tjpic">
					<i><img src="../static/images/toppic01.jpg"></i>
					<p><a href="#">别让这些闹心的套路，毁了你的网页设计</a></p>
				</ul>
				<ul class="sidenews">
					<li> <i><img src="../static/images/toppic01.jpg"></i>
						<p><a href="#">别让这些闹心的套路，毁了你的网页设计</a></p>
						<span>2018-05-13</span>
					</li>
					<li> <i><img src="../static/images/toppic02.jpg"></i>
						<p><a href="#">给我模板PSD源文件，我给你设计HTML！</a></p>
						<span>2018-05-13</span>
					</li>
					<li> <i><img src="../static/images/v1.jpg"></i>
						<p><a href="#">别让这些闹心的套路，毁了你的网页设计</a></p>
						<span>2018-05-13</span>
					</li>
					<li> <i><img src="../static/images/v2.jpg"></i>
						<p><a href="#">给我模板PSD源文件，我给你设计HTML！</a></p>
						<span>2018-05-13</span>
					</li>
				</ul>
			</div>
			<div class="tuijian">
				<h2 class="hometitle">点击排行</h2>
				<ul class="tjpic">
					<i><img src="../static/images/toppic01.jpg"></i>
					<p><a href="#">别让这些闹心的套路，毁了你的网页设计</a></p>
				</ul>
				<ul class="sidenews">
					<li> <i><img src="../static/images/toppic01.jpg"></i>
						<p><a href="#">别让这些闹心的套路</a></p>
						<span>2018-05-13</span>
					</li>
					<li> <i><img src="../static/images/toppic02.jpg"></i>
						<p><a href="#">给我模板PSD源文件，我给你设计HTML！</a></p>
						<span>2018-05-13</span>
					</li>
					<li> <i><img src="../static/images/v1.jpg"></i>
						<p><a href="#">别让这些闹心的套路，毁了你的网页设计</a></p>
						<span>2018-05-13</span>
					</li>
					<li> <i><img src="../static/images/v2.jpg"></i>
						<p><a href="#">给我模板PSD源文件，我给你设计HTML！</a></p>
						<span>2018-05-13</span>
					</li>
				</ul>
			</div>
			<div class="cloud">
				<h2 class="hometitle">标签云</h2>
				<ul>
					<a href="#">陌上花开</a> <a href="#">校园生活</a> <a href="#">html5</a> <a href="#">SumSung</a> <a href="#">青春</a> <a href="#">温暖</a>
					<a href="#">阳光</a> <a href="#">三星</a><a href="#">索尼</a> <a href="#">华维荣耀</a> <a href="#">三星</a>
					<a href="#">索尼</a>
				</ul>
			</div>
			<div class="guanzhu" id="follow-us">
				<h2 class="hometitle">关注我们 么么哒！</h2>
				<ul>
					<li class="sina"><a href="#" target="_blank"><span>微信公众号</span>达内</a></li>
					<li class="tencent"><a href="#" target="_blank"><span>微信咨询</span>XXX</a></li>
					<li class="qq"><a href="#" target="_blank"><span>QQ号</span>XXXXXX</a></li>
					<li class="email"><a href="#" target="_blank"><span>邮箱帐号</span>tedu.cn</a></li>
					<li class="wxgzh"><a href="#" target="_blank"><span>咨询电话</span>xxxxxxxxxxx</a></li>
				</ul>
			</div>
		</div>
	</article>
{% endblock %}

{% block foot %}
	{#    评论#}
        <script>
            function GetComments(){
                $.get("/get_comments?article_id={{ article.id }}",function(callback){
                    $(".comment-list").html(callback);

                {#动态添加评论#}
                    $(".add-comment").click(function() {
                        var commemt_id = $(this).attr("comment-id");
                        //克隆评论框
                        var new_comment_box = $(".new-comment-box").clone(true);
                        $(".new-comment-box").remove();
                        $(this).parent().append(new_comment_box);
                        $(".form-control").val("");
                        $(".new-comment-box").css("display", "block");
                    })
                })
            }

            $(document).ready(function () {
                GetComments();
                $(".comment button").click(function () {
                    var comment_text = $(this).prev().val();
                    if (comment_text.trim().length < 5){
                        alert("不能少于5个字符！");
                    }
                    else {
                            var parent_comment_id = $(this).parent().prev().attr("comment-id");
                            if (typeof parent_comment_id == "undefined"){
                            var parent_comment_id = "0";
                        }
                        $.post("/post_comment",
                            {
                                article_id:"{{ article.id }}",
                                parent_comment_id:parent_comment_id,
                                comment:comment_text.trim(),
                            },
                            function (callback){
                                console.log(callback);
                                if (callback.split("|")[0] == 'post-comment-success'){
                                    $(this).prev().val("");
                                    if(callback.split("|")[1] == "1"){
                                        var count = document.getElementById("comment_number").innerText;
                                        document.getElementById("comment_number").innerText = parseInt(count) + 1;
                                    }
                                    var new_comment_box = $(".new-comment-box").clone(true);
                                    $(".new-comment-box").remove();
                                    $(".comment-list").before(new_comment_box);
                                    $(".new-comment-box input").val("");
                                    GetComments();
                                    $(".new-comment-box").css("display", "none");
                                }
                                else if(callback == 'post-comment-fail'){
                                    alert('post-comment-fail');
                                    GetComments();
                                    $(".new-comment-box").css("display", "none");
                                }
                            }
                        )
                    }
                });
            });
            </script>
{% endblock %}
